# 认识与分析登陆文件
登陆文件就是记录系统活动信息的那几个文件,记录系统在什么时候由哪个进程做了什么样的行为,发生了何种事件等等.
- 常用的登陆文件
  - **`/var/log/boot.log`**  :开机的时候系统核心会去侦测与启动硬件,接下来开始各种核心支持的功能启动等.
  - **`/var/log/cron`**  :例行工作调度 crontab 有没有被进行, 进行过程是否有错误,/etc/crontab是否撰写正确.
  - **`/var/log/dmesg`** :记录系统在开机的时候 核心侦测过程所产生的各项信息.
  - **`/var/log/lastlog`** :记录系统上面所有的账号最近一次登陆系统时的相关信息
  - **`/var/log/maillog 或 /var/log/mail/*`** :记录邮件的来往信息,主要是记录 postfix(SMTP协定提供者) 与dovecot(POP3协定提供者) 所产生的讯息.SMTP是发信使用的通信协定,POP3是收信使用的通信协议.
  - **`/var/log/messages`** :系统发生的错误信息都会记录在这个文件,非常重要.
  - **`/var/log/secure`**  :只要涉及到'需要输入账号密码'的软件,当登陆时欧蕙记录在此文件
  - **`/var/log/wtmp , /var/log/faillog`** :正确登陆者的账号信息(wtmp),错误登陆时所使用的账号信息(faillog)
  - **`/var/log/httpd , /var/log/samba/`** :不同网络服务会使用他们自己的登陆文件来记录他们自己产生的各项讯息.

### 登陆文件所需相关服务与进程
- 登陆文件有两个产生方式
  - 有软件开发商自行定义写入的登陆文件与相关格式
  - Linux 提供的登陆文件管理服务来统一管理,Centos提供 rsyslog.service 这个服务来统一管理.
- 针对登陆文件所需的功能,需要的服务与进程有:
  - `systemd-journald.service`  :最主要的信息接受者,由systemd 提供
  - `rsyslog.service`  :主要登陆系统与网络等服务的讯息
  - `logrotate`  :主要在进行登陆文件的轮替功能(删旧建新)

###  登陆文件的一般格式
- 事件发生的日期与时间
- 发生此事件的主机名称
- 启动此事件的服务名称 或指令与函数名称
- 该讯息的实际数据内容

## rsyslog.service :记录登陆文件的服务
Linux登陆文件主要是由 rsyslog.service 在负责, 所以必须保持开机启动.

### rsyslog.service 的配置文件 :/etc/rsyslog.conf
/etc/rsyslog.conf 是服务 rsyslogd 这个守护进程的配置文件.
rsyslogd 服务负责主机产生的各个信息的登陆,这些信息本身就有 **严重等级** 之分,而且数据最终传送到哪个文件去 时可以修改的.
rsyslogd 针对各种服务与信息记录在某些文件的配置文件就是 /etc/rsyslog.conf
- 这个文件规定了
  - 什么服务
  - 服务的等级讯息
  - 需要被记录在哪里(设备或文件)

将各种类别的服务之登陆文件,记录在不同的文件内,就是 `rsyslog.conf` 所要做的规范.

```bash
rsyslog.conf 配置文件的语法:

服务名称[.=!]讯息等级     [-]讯息记录的文件名或设备或主机

#上面的 - 号 表示先暂时把数据存放在内存中,等数据累计到一定程度之后,再集体写入内存.
#下面是 mail 这个服务产生的 info 等级为例:

mail.info  /var/log/mail.info

#这一行说明: mail 服务产生的 大于或等于 info 等级的讯息，都记录到 /var/log/mail.info文件中.

#将新闻群组(news)数据, 例行性工作调度(cron) 的信息都写入/var/log/cronnews 文件中,但是这两个程序的警告讯息都记录在 /var/log/cronnews.warn中
  news.*;cron.*   /var/log/cronnews
  news.=warn;cron.=warn    /var/log/cronnews.warn

#将所有服务的信息都写入 messages 文件,但是不要记录 cron,mail,news 的信息
  *.*;news,cron,mail.none    /var/log/mssages
  第二种写法: *.*;news.none;crone.none;mail.none  /var/log/mssages
```
- 配置文件语法的详细描述:
  - 服务名称
    - 可使用 `man 3 syslog` 查询
	- 序号0 ,服务类别 kern ,就是核心产生的信息,大部分都是硬件侦测以及核心功能的启用
	-     1 ,         user ,在使用者层级产生的信息
	-     2 ,         mail ,只要与邮件收发有关的讯息记录都属于这个.
    - 多个服务之间使用 ； 分号来进行间隔.
	-  ....省略, 使用 man 去查询,每种 Linux 发行版都会有些许区别
  - 讯息等级  (一共7个的等级,根据 syslog.h 定义的)
    - 等级数值7,名称debug ,用了排错时产生的讯息数据. none也是同样效果.
	-         6,     info ,仅是一些基本的讯息说明而已
	-         5,   notice ,正常信息,但比info需要注意到一些信息的内容.
	-         4,warning(warn) ,警告的讯息,可能有问题,但不至于影响某个 服务 运行的讯息.
	-         3,err(error),一些重大的错误讯息,例如配置文件设置错误
	-         2,     crit ,更严重的错误信息,这里是临界点,说明错误已经很严重了
	-         1,    alart ,警告警告,以及很有问题的等级.很严重了.
	-         0,emerg(panic) ,最高等级, 系统已经处于几乎要死机的状态,通常只有硬件出问题,才会导致这个等级讯息
  - 讯息等级前的 [ . = !] 这些链接符号的含义
    - .   代表比后面还要严重的等级(含该等级)都被记录下来 到后面文件内
	- .=  代表所需要的等级就是后面接的等级而已,其他不需要
	- .!  代表不等于, 除了该等级外, 其他等级都记录
  - 讯息记录的文件名或设备或主机
    - 文件的绝对路径 :通常就是放在 `/var/log` 里面的文件
	- 打印机或其他   :例如 `/dev/lp0` 这个打印设备
	- 使用者名称     :显示给使用者
    - 远程主机       :例如 **`@study.vbird.tsai`** ,但是对方主机也能支持才可以
	-   *            :代表目前线上的所有人, 类似于wall 这个指令的意义.
```bash
syslog    这个是Linux核心提供的登陆文件设计指引,所有的要求都写入了 syslog.h 文件中.(开发与登陆文件有关的软件)
rsyslogd  为了要达成实际上进行讯息分类所开发的一套软件.这是最基本的守护进程
rsyslog.service  为了加入systemd 的控制,因此 rsyslogd 的开发者设计的启动脚本设置
```




