# 文件与文件系统的压缩, 打包和备份

## 文件压缩和解压缩

* .Z
  * compress  程序压缩文件, 可以使用 **`gzip`** 命令进行解压缩.
* **.zip**
  * zip  程序压缩文件, 使用 **`gzip`** 命令进行压缩和解压缩.
* **.gz**
  * gzip  程序压缩文件,   使用 **`gzip`** 命令进行压缩和解压缩.
* **.bz2**
  * bzip2  程序压缩文件, 使用 **`bzip2`** 命令进行压缩和解压缩.
* **.xz**
  * xz 程序压缩的文件,  使用 **`xz`** 命令 来进行压缩和解压缩.
* **.tar**
  * **tar  程序打包的`数据`, `并没有压缩过`.**
* **.tar.gz**
  * tar 程序打包的文件, 其中并且经过  **gzip** 的压缩.
* **.tar.bz2**
  * tar  程序打包的文件, 其中并且经过  **bzip2**  的压缩.
* **.tar.xz**
  * tar 程序打包的文件,  其中并且经过 **xz** 的压缩.

### gzip   , zcat/ zmore/ zless/ zgrep

**gzip是目前应用度最广的压缩指令, 可以解开** **`compress(.Z)  zip(.zip) 与 gzip(.gz)` 等软件所压缩过的文件**

 **`zcat/ zmore/ zless/ zgrep`  这些指令是在对压缩文件不进行解压的情况下,来查看压缩包内文本文件的内容的.**

```bash
$gzip  选项  文件名
选项和参数:
-c    :将压缩的数据输出到屏幕上,可用于重定向写入文件.(就是压缩包的内容)
-d    :进行解压缩 
-t    :可以用来检验一个压缩文件的一致性 ~可以看看文件有无错误;
-v    :可以显示出源文件/压缩文件的压缩等信息;
-数字  :代表压缩等级.  1 表示最快 但压缩比最差, 9最慢 但压缩比最好, 默认值是6

$zcat 压缩包名.gz    # 该命令可以将.gz 压缩包的文本文件内容读取出来.(只可以是单个文件的)

范例1: 找出 /etc 下面 (不含子目录) 容量最大的文件，并将它复制到 /tmp ，然后以 gzip 压缩
$ls -ldSr /etc/*            #会输出/etc/ 下面所有子目录当中文件大小最大的文件,按照从小到大排序
    #比如找到的最大占用文件就是  /etc/services
$cd /tmp
$cp /etc/services   /tmp     #将文件拷贝过去
$gzip  -v  services          #进行压缩, 会得到 services.gz 文件,并且service原文件会消失


范例2:由于上个范例压缩的是文本文件,所以可以使用 zcat 命令来将其内容读取出来.
$zcat    services.gz        #直接可以将这个文件的内容读取出来


范例3:将 services.gz 文件解压缩.
$gzip  -d    services.gz      #该指令会将services.gz 解压缩,但是 services.gz 文件会消失.


范例4: 在services.gz 中找到 http 这个关键字在第几行.
$zgrep -n 'http'  services.gz        #并不会进行解压缩,只是在 services 中寻找 http


范例5: 保留 services 文件,并创建一个 services.gz 文件,才用-9等级压缩, 使用重定向.
$gzip -c -9 services > services.gz        #后面是压缩文件,前面是将压缩后的数据打印到屏幕上

```

### bzip2  , bzcat/bzmore/bzless/bzgrep

**bzip2 则是为了取代 gzip 并提供更佳的压缩比而来的.**

```bash
$bzip2   选项  文件名
选项和参数:
-c    :将压缩的过程产生的数据输出到屏幕上.
-d    :解压缩
-k    :保留原始文件,无论压缩还是解压缩
-z    :压缩    (默认值,可以不加)
-v    :可以显示出 原文件/压缩文件 的压缩比等信息.
-数字  :与 gzip 相同,都是在计算压缩比的参数,  -9 最佳, -1最快, 默认-6

$bzcat    压缩文件.bz2      #和 zcat 命令 相同.

范例: 保留文件 进行 -9 最高等级压缩.
$bzip2 -k -9 services             #会得到一个services.bz2 的压缩包文件
```

### **xz , xzcat/xzmore/xzless/xzgrep**

**压缩比更高,用法也和 gzip/bzip2 一样.**

```bash
$xz  选项  文件名
选项和参数:
-d    :解压缩
-t    :测试解压文件的完整性, 看有没有错误.
-l    :列出压缩文件的相关信息
-k    :保留原文件, 无论压缩和解压缩
-c    :将压缩包 数据输出到屏幕上,主要用来重定向.
-v    :可以显示出 原文件/压缩文件 的压缩比等信息.
-数字  :压缩比, -9最佳, -1最快, 默认-6

$xcat  压缩包.xz        #也是在不解压的情况下查看压缩包内文本文件的内容.

范例: 压缩文件 service ,变成压缩包 service.xz, 并答应出压缩比信息.
$xz -v services
输出: services (1/1)
        100 %        97.3 KiB / 654.6 KiB = 0.149    

范例2: 保留原文件 service 并进行压缩.
$xz -k services        #原文件会被保留,并且会出现一个 services.xz 压缩包文件
```

## 打包指令  : tar

**tar** 是将多个文件或目录包成一个大文件的指令指令. 而且还可以通过 **`gzip/bzip2/xz`** 的支持.

```bash
$tar  [-z | -j | -J ] [cv] [-f 待创建的新文件名] filename     #打包
$tar  [-z | -j | -J ] [tv] [-f 既有的 tar 文件名]            #查看
$tar  [-z | -j | -J ] [xv] [-f 既有的 tar 文件名] [-C 目录]   #解压
选项与参数:
-c   :创建打包文件，可搭配 -v 来察看过程中被打包的文件名(filename)
-t   :察看打包文件的内容含有哪些文件名，重点在察看“文件名”就是了;
-x   :解打包或解压缩的功能，可以搭配 -C (大写) 在特定目录解开特别留意的是,
      -c, -t, -x 不可同时出现在一串命令行中。
-z   :通过 gzip 的支持进行  压缩/解压缩 :此时文件名最好为 *.tar.gz
-j   :通过 bzip2 的支持进行  压缩/解压缩 :此时文件名最好为 *.tar.bz2
-J   :通过 xz 的支持进行  压缩/解压缩 :此时文件名最好为 *.tar.xz 特别留意， 
      -z, -j, -J 不可以同时出现在一串命令行中
      如果不加 -z -j -J 的话,那么后戳名给 .tar
-v   :在 压缩/解压缩 的过程中，将正在处理的文件名显示出来!
-f filename  :-f 后面要立刻接要被处理的文件名!建议 -f 单独写一个选项啰!(比较不会忘记)
-C 目录      :这个选项用在解压缩，若要在特定目录解压缩，可以使用这个选项。

-p   :保留备份数据的原本权限与属性, 常用与备份(-c) 重要的配置文件
-P   :保留绝对路径,亦即允许备份数据中含有根目录存在之意.( 这个选项尽量不要用,非常危险)
--exclude=FILE   :在压缩过程中,不要将FILE打包.

实用的三种命令格式:
$tar -jcv -f  新文件名.tar.bz2  要被压缩的文件或目录     #压缩
$tar -Jtv -f  文件名.tar.xz                          #查询
$tar -zxv -f  文件名.tar.gz   -C 放置解压缩的目录       #解压缩

范例1: 备份 /etc 下的配置文件.并且保留原本文件的权限与属性(-p 选项).
$su      #root权限
$time tar -zpcv -f /root/etc.tar.gz  /etc      #备份文件是 etc.tar.gz ,time计算消耗时间

范例2: 解压缩 etc.tar.gz 的所有文件,并放入指定的目录 /tmp/etc 内
$tar -zxv -f etc.tar.gz  -C  /tmp/etc

范例3: 查阅压缩包的内容, 并找到 'shadow' 这个文件, 并且把它单一的解压出来
$tar -ztv -f etc.tar.gz  | grep 'shadow'      #压缩包内确实有这个文件
  输出: ---------- root/root      1299 2019-10-10 09:11 etc/shadow   #这个就是要找的
$tar -zxv -f etc.tar.gz   etc/shadow            #找到了,并且把它单独解压了出来在当前目录

范例4:  

```

\*\*\*\*

\*\*\*\*

\*\*\*\*

\*\*\*\*

\*\*\*\*

\*\*\*\*

\*\*\*\*

\*\*\*\*

